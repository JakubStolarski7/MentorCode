{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/MentorCode/mentor_main/app/api/explain/route.ts"],"sourcesContent":["// app/api/explain/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport OpenAI from 'openai';\r\n\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\n// ... (Funkcja getLanguageDetails bez zmian)\r\nconst getLanguageDetails = (lang: string) => {\r\n    const l = lang.toLowerCase().trim();\r\n    switch (l) {\r\n        case \"python\":\r\n            return {\r\n                name: \"Python\",\r\n                details: \"U≈ºywaj sk≈Çadni Python 3.11+. Pamiƒôtaj o wciƒôciach, duck typing, list comprehensions i typowaniu (np. def f(x: int) -> bool).\"\r\n            };\r\n        case \"javascript\":\r\n            return {\r\n                name: \"JavaScript\",\r\n                details: \"U≈ºywaj ES2023+. Pamiƒôtaj o r√≥≈ºnicach: let/const, funkcje strza≈Çkowe, async/await, i braku statycznego typowania.\"\r\n            };\r\n        case \"java\":\r\n            return {\r\n                name: \"Java\",\r\n                details: \"U≈ºywaj Java 17+. Pamiƒôtaj o typach generycznych, interfejsach, konwencjach (camelCase), i ≈õcis≈Çym typowaniu.\"\r\n            };\r\n        case \"cpp\":\r\n            return {\r\n                name: \"C++\",\r\n                details: \"U≈ºywaj C++17. Pamiƒôtaj o: wska≈∫nikach vs referencjach, RAII, zarzƒÖdzaniu pamiƒôciƒÖ (new/delete), i r√≥≈ºnicach stack/heap.\"\r\n            };\r\n        case \"csharp\":\r\n            return {\r\n                name: \"C#\",\r\n                details: \"U≈ºywaj C# 10+. Pamiƒôtaj o: w≈Ça≈õciwo≈õciach, LINQ, async/await, namespace‚Äôach i typach referencyjnych/warto≈õciowych.\"\r\n            };\r\n        default:\r\n            return {\r\n                name: l.charAt(0).toUpperCase() + l.slice(1),\r\n                details: `U≈ºywaj typowych konstrukcji jƒôzyka ${l}. Dostosuj wyja≈õnienia do jego sk≈Çadni i filozofii.`\r\n            };\r\n    }\r\n};\r\n\r\n// ‚úÖ Handler API\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { question, language = \"python\" } = await req.json();\r\n\r\n    // Walidacja\r\n    if (!question || typeof question !== 'string' || question.trim().length < 5) {\r\n      return NextResponse.json(\r\n        { error: 'Pytanie musi mieƒá co najmniej 5 znak√≥w.' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    // Pobierz szczeg√≥≈Çy jƒôzyka\r\n    const langDetails = getLanguageDetails(language);\r\n\r\n    // SYSTEM PROMPT: Wzmo≈ºone wymagania edukacyjne i RYGORYSTYCZNE ZASADY FORMATOWANIA\r\n    const SYSTEM_PROMPT = `Jeste≈õ polskim mentorem programowania, Twoim jedynym celem jest przeprowadzenie **kompletnej, dog≈Çƒôbnej, dydaktycznej lekcji** dla ucznia. Odpowied≈∫ musi byƒá zrozumia≈Ça, wyczerpujƒÖca i **PERFEKCYJNIE ZFORMATOWANA**.\r\nDzisiaj t≈Çumaczysz z≈Ço≈ºone koncepcje w jƒôzyku: **${langDetails.name}**.\r\n\r\nSzczeg√≥≈Çy kontekstowe:\r\n${langDetails.details}\r\n\r\nZasady formatowania i generowania odpowiedzi:\r\n1. Odpowiadaj WY≈ÅƒÑCZNIE po polsku.\r\n2. Odpowied≈∫ MUSI mieƒá 4 **bardzo szczeg√≥≈Çowe** sekcje, dok≈Çadnie w tej kolejno≈õci.\r\n\r\nInstrukcje dla ka≈ºdej sekcji:\r\n‚úÖ **Kod**: Zawsze umie≈õƒá **kompletne, dzia≈ÇajƒÖce** rozwiƒÖzanie w bloku \\`\\`\\`${language}\\n...\\n\\`\\`\\`. **KRYTYCZNE**: Wciƒôcia w kodzie Pythona muszƒÖ byƒá zachowane (u≈ºywaj 4 spacji/tabulator√≥w). Kod ma byƒá czytelny i zgodny z PEP 8.\r\nüß† **Jak to dzia≈Ça?**: To jest serce lekcji. U≈ºywaj nag≈Ç√≥wk√≥w Markdown (np. ### Teoria) i list numerowanych/punktowanych. Wyja≈õnienie musi mieƒá **dwie fazy**:\r\n    a) **Teoria i Kontekst**: G≈Çƒôboko wyja≈õnij podstawowe koncepcje. U≈ºywaj **pogrubie≈Ñ** dla kluczowych termin√≥w i formatowania matematycznego LaTeX (\\`$...\\$\\` dla r√≥wna≈Ñ inline).\r\n    b) **Analiza Implementacji**: Przeanalizuj *ka≈ºdƒÖ czƒô≈õƒá* kodu z sekcji ‚úÖ **Kod**.\r\n‚ö†Ô∏è **Typowe b≈Çƒôdy**: Podaj **przynajmniej trzy** realne b≈Çƒôdy. U≈ºywaj **list numerowanych**. Dla ka≈ºdego b≈Çƒôdu, u≈ºyj formatowania pogrubionego, aby opisaƒá: **1. Przyczyna**, **2. Konsekwencje**, **3. Unikanie**.\r\nüîÅ **Inne podej≈õcia**: Podaj **przynajmniej dwa** alternatywne, bardziej zaawansowane rozwiƒÖzania. U≈ºywaj list punktowanych. **Szczeg√≥≈Çowo wyja≈õnij** ich zalety (np. z≈Ço≈ºono≈õƒá $O(\\log n)$) i **kontekst u≈ºycia**.\r\n\r\n3. Po ka≈ºdej sekcji u≈ºywaj dw√≥ch nowych linii, aby zapewniƒá czytelne odstƒôpy.\r\n4. Nie dodawaj wstƒôpu, ani podsumowania. Zacznij bezpo≈õrednio od ‚úÖ.`;\r\n\r\n    // U≈ºywamy GPT-4o Mini\r\n    const response = await openai.chat.completions.create({\r\n      model: \"gpt-4o-mini\", \r\n      messages: [\r\n        { role: \"system\", content: SYSTEM_PROMPT.trim() },\r\n        { \r\n          role: \"user\", \r\n          content: `Pytanie ucznia: \"${question.trim()}\"\\n\\nWygeneruj pe≈ÇnƒÖ, dydaktycznƒÖ lekcjƒô zgodnie z rygorystycznymi zasadami formatowania, aby tre≈õƒá by≈Ça MAKSYMALNIE czytelna.` \r\n        },\r\n      ],\r\n      max_tokens: 4000, \r\n    });\r\n\r\n    // Ekstrakcja i walidacja odpowiedzi\r\n    const answer = response.choices[0]?.message?.content?.trim();\r\n    if (!answer || answer.length < 500) { \r\n      throw new Error(\"Model nie wygenerowa≈Ç wystarczajƒÖco obszernej odpowiedzi. Sprawd≈∫ limit max_tokens.\"); \r\n    }\r\n\r\n    // Sukces\r\n    return NextResponse.json({\r\n      success: true,\r\n      question: question.trim(),\r\n      answer,\r\n      language,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    let errorMessage = \"Nie uda≈Ço siƒô wygenerowaƒá wyja≈õnienia. Spr√≥buj ponownie.\";\r\n    \r\n    if (error.message.includes(\"does not exist\") || error.message.includes(\"404\")) {\r\n        errorMessage = \"B≈ÅƒÑD MODELU: Model gpt-4o-mini nie jest dostƒôpny. U≈ºyj 'gpt-3.5-turbo'.\";\r\n    } else if (error.message.includes(\"API key\")) {\r\n        errorMessage = \"B≈ÅƒÑD KLUCZA API: Sprawd≈∫ klucz OPENAI_API_KEY.\";\r\n    } else if (error.message.includes(\"rate limit\")) {\r\n        errorMessage = \"Przekroczono limit zapyta≈Ñ do API. Spr√≥buj za chwilƒô.\";\r\n    }\r\n    \r\n    console.error(\"[AI Error]\", error.message);\r\n    return NextResponse.json(\r\n      { error: errorMessage },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AAC3B;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,kMAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEA,6CAA6C;AAC7C,MAAM,qBAAqB,CAAC;IACxB,MAAM,IAAI,KAAK,WAAW,GAAG,IAAI;IACjC,OAAQ;QACJ,KAAK;YACD,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;QACJ,KAAK;YACD,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;QACJ,KAAK;YACD,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;QACJ,KAAK;YACD,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;QACJ,KAAK;YACD,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;QACJ;YACI,OAAO;gBACH,MAAM,EAAE,MAAM,CAAC,GAAG,WAAW,KAAK,EAAE,KAAK,CAAC;gBAC1C,SAAS,CAAC,mCAAmC,EAAE,EAAE,mDAAmD,CAAC;YACzG;IACR;AACJ;AAGO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,WAAW,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAExD,YAAY;QACZ,IAAI,CAAC,YAAY,OAAO,aAAa,YAAY,SAAS,IAAI,GAAG,MAAM,GAAG,GAAG;YAC3E,OAAO,+JAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0C,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,cAAc,mBAAmB;QAEvC,mFAAmF;QACnF,MAAM,gBAAgB,CAAC;iDACsB,EAAE,YAAY,IAAI,CAAC;;;AAGpE,EAAE,YAAY,OAAO,CAAC;;;;;;;6EAOuD,EAAE,SAAS;;;;;;;;mEAQrB,CAAC;QAEhE,sBAAsB;QACtB,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;gBACR;oBAAE,MAAM;oBAAU,SAAS,cAAc,IAAI;gBAAG;gBAChD;oBACE,MAAM;oBACN,SAAS,CAAC,iBAAiB,EAAE,SAAS,IAAI,GAAG,8HAA8H,CAAC;gBAC9K;aACD;YACD,YAAY;QACd;QAEA,oCAAoC;QACpC,MAAM,SAAS,SAAS,OAAO,CAAC,EAAE,EAAE,SAAS,SAAS;QACtD,IAAI,CAAC,UAAU,OAAO,MAAM,GAAG,KAAK;YAClC,MAAM,IAAI,MAAM;QAClB;QAEA,SAAS;QACT,OAAO,+JAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU,SAAS,IAAI;YACvB;YACA;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,IAAI,eAAe;QAEnB,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,qBAAqB,MAAM,OAAO,CAAC,QAAQ,CAAC,QAAQ;YAC3E,eAAe;QACnB,OAAO,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,YAAY;YAC1C,eAAe;QACnB,OAAO,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,eAAe;YAC7C,eAAe;QACnB;QAEA,QAAQ,KAAK,CAAC,cAAc,MAAM,OAAO;QACzC,OAAO,+JAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAa,GACtB;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}